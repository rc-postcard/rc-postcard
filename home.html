<!DOCTYPE html>
<html lang="en">

<head>
    <title>rc-postcard</title>
    <script type="text/javascript">
        window.onload = function () {
            const submitPhotoButton = document.getElementById('submitPhoto');
            const submitPostcardButton = document.getElementById('submitPostcard')
            const recipientSelector = document.getElementById('recipientSelector')

            fetch("/contacts").then(response => 
                response.json()
            ).then(data => {
                contacts = data["contacts"]
                contacts.forEach(contact => {
                    var opt = document.createElement('option')
                    opt.value = contact["recurseId"]
                    opt.innerHTML = contact["name"] + " (" + contact["email"] + ")"
                    recipientSelector.appendChild(opt)
                });
            })

            submitPhotoButton.addEventListener('click', function () {
                console.log("clicked")
                let photo = document.getElementById("postcardFileInput").files[0]
                if (!photo) {
                    console.log("no photo")
                    return;
                }
                let formData = new FormData()
                formData.append("front-postcard-file", photo)
                fetch("/postcardPreview", { method: "POST", body: formData }).then(response =>
                    response.json()
                ).then(data => {
                    pdfPreviewLink = document.getElementById("pdfPreviewLink")
                    pdfPreviewLink.innerText = data['url']
                    pdfPreviewLink.href = data['url']
                })
            });

            submitPostcardButton.addEventListener('click', function () {
                let photo = document.getElementById("postcardFileInput").files[0]
                if (!photo) {
                    console.log("no photo")
                    return
                }
                if (!recipientSelector.value) {
                    console.log("no recipient")
                    return
                }

                console.log("sending postcard")

                // fetch("/postcard", { method: "POST", body: formData }).then(response =>
                //     response.json()
                // ).then(data => {
                //     pdfPreviewLink = document.getElementById("pdfPreviewLink")
                //     pdfPreviewLink.innerText = data['url']
                //     pdfPreviewLink.href = data['url']
                // })
            })
        }
    </script>
    <style>
        * {
            box-sizing: border-box;
            font-family: sans-serif;
            color: #333333;
        }

        input {
            display: block;
            font-size: 1.05rem;
            width: 100%;
            padding: 10px;
            border-radius: .25rem;
            border: solid 1px #8c8c8c;
            margin: 0;
        }

        label {
            display: block;
            font-size: 1.1rem;
            margin: 20px 0 5px 0;
        }

        button {
            background-color: #0594d8;
            color: #ffffff;
            border-color: #ffffff;
            font-size: 1.1rem;
            margin-top: 10px;
            width: 100px;
        }
    </style>
</head>

<body>
    <input type="file" id="postcardFileInput" />
    <button id="submitPhoto">Submit</button>
    <div>
        <label id="pdfPreviewLabel">PDF Preview (try refreshing a few times)</label>
        <a id="pdfPreviewLink" href=""></a>
    </div>
    <div>
        <label>Select who you'd like to send your postcard to. See someone in RC who's not on the list? Tell them to
            sign up at LINK</label>
        <select id="recipientSelector" name="Recipient" id="receipients">
            <!-- <option value="recurse_center_id">Recurse Center</option>
            <option value="recurse_id">Joseph Tobin</option> -->
        </select>
        <br><br>
    </div>
    <button id="submitPostcard">Looks good, submit!</button>
</body>

</html>